================================================================================
구글 스프레드시트 실시간 연동 가이드
================================================================================

작성일: 2026-01-20
목적: 파이썬(DB) 데이터를 구글 스프레드시트로 자동 전송하는 방법 설명


Q. 파이썬 DB를 구글 시트와 연동하는 게 쉬운가요?
================================================================================
A. 네, 아주 쉽습니다. `gspread`라는 라이브러리를 쓰면 엑셀 파일 다루듯이 코드로 시트를 읽고 쓸 수 있습니다.


준비 절차 (딱 1번만 설정)
================================================================================

1. 구글 클라우드 설정
   1) Google Cloud Console 접속 (https://console.cloud.google.com/)
   2) 새 프로젝트 생성 (예: Trend-Analyzer)
   3) 'Google Sheets API'와 'Google Drive API' 사용 설정(Enable).

2. 서비스 계정(Service Account) 생성
   1) 'IAM 및 관리' -> '서비스 계정' 이동.
   2) 계정 생성 후 '키(Key)' 탭에서 'JSON 키 만들기' 클릭.
   3) 다운로드된 JSON 파일(예: `trend-analyzer-xxxx.json`)을 프로젝트 `data/` 폴더에 저장.
   4) 파일명을 `service_account.json`으로 변경.

3. 스프레드시트 공유
   1) 브라우저에서 새 구글 스프레드시트 생성.
   2) [공유] 버튼 클릭.
   3) JSON 파일 안에 있는 `client_email` 주소(예: xxx@trend-analyzer.iam.gserviceaccount.com)를 복사해서 공유 멤버로 추가. (편집자 권한)


파이썬 코드 예시 (light_mode/gsheet.py)
================================================================================

import gspread
from oauth2client.service_account import ServiceAccountCredentials

def sync_to_google_sheet(dataframe):
    # 1. 인증
    scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
    creds = ServiceAccountCredentials.from_json_keyfile_name('data/service_account.json', scope)
    client = gspread.authorize(creds)
    
    # 2. 시트 열기 (시트 이름으로)
    sh = client.open("트렌드_분석_결과_2026")
    worksheet = sh.worksheet("종합_랭킹")
    
    # 3. 데이터 쓰기
    # 기존 내용 지우기
    worksheet.clear()
    
    # 헤더 + 데이터 업데이트
    # gspread와 pandas를 같이 쓰면 아래 한 줄로 끝납니다.
    # set_with_dataframe(worksheet, dataframe) -> 라이브러리 설치 필요
    
    # 또는 기본 리스트 방식:
    data_list = [dataframe.columns.values.tolist()] + dataframe.values.tolist()
    worksheet.update('A1', data_list)
    
    print("구글 시트 동기화 완료!")


실시간 연동의 의미
================================================================================
- 엄밀히 말해 "DB가 변경되자마자 0.1초 만에 시트가 바뀌는" 소켓 통신은 아닙니다.
- 우리가 만드는 방식은 **"수집 프로그램이 끝날 때 최신 상태를 시트에 덮어쓰기"** 하는 방식입니다.
- 결과적으로 사용자가 시트를 켰을 때는 항상 최신 데이터를 볼 수 있으므로 목적에 100% 부합합니다.
