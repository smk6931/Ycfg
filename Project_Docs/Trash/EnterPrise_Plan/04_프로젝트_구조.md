================================================================================
프로젝트 디렉토리 구조 및 모듈 설계
================================================================================

작성일: 2026-01-20
목적: Python 프로젝트의 전체 디렉토리 구조와 각 모듈의 역할 정의


전체 디렉토리 구조
================================================================================

Ycfg/
├── venv/                          # 가상환경 (gitignore)
├── .env                            # 환경변수 (API 키 저장, gitignore)
├── .gitignore                      # Git 제외 파일
├── requirements.txt                # Python 패키지 의존성
├── README.md                       # 프로젝트 설명
│
├── Project_Docs/                   # 프로젝트 문서 (사용자 규칙 적용)
│   ├── 01_프로젝트_개요.md
│   ├── 02_API_수집_전략.md
│   ├── 03_점수_산정_알고리즘.md
│   ├── 04_프로젝트_구조.md
│   ├── 05_데이터베이스_스키마.md
│   └── Daily_Log/                 # 일일 작업 로그
│       ├── 2026-01-20.md
│       └── 2026-01-21.md
│
├── src/                            # 소스 코드 루트
│   ├── __init__.py
│   │
│   ├── main.py                     # FastAPI 메인 앱
│   │
│   ├── core/                       # 핵심 설정 및 유틸리티
│   │   ├── __init__.py
│   │   ├── config.py               # 환경변수 및 설정
│   │   ├── database.py             # DB 연결 설정
│   │   ├── redis_client.py         # Redis 캐시
│   │   └── logger.py               # 로깅 설정
│   │
│   ├── models/                     # SQLAlchemy 모델
│   │   ├── __init__.py
│   │   ├── keyword.py              # 트렌드 키워드 모델
│   │   ├── raw_data.py             # 원시 수집 데이터
│   │   ├── normalized_data.py      # 정규화 데이터
│   │   └── report.py               # 리포트 모델
│   │
│   ├── schemas/                    # Pydantic 스키마
│   │   ├── __init__.py
│   │   ├── keyword.py
│   │   ├── data.py
│   │   └── report.py
│   │
│   ├── collectors/                 # 데이터 수집 모듈
│   │   ├── __init__.py
│   │   ├── base_collector.py       # 추상 베이스 클래스
│   │   ├── google_trends.py        # Google Trends 수집
│   │   ├── youtube.py              # YouTube 수집
│   │   ├── instagram.py            # Instagram 수집
│   │   ├── news_rss.py             # Google News RSS
│   │   └── threads.py              # Threads 수집
│   │
│   ├── processors/                 # 데이터 처리 모듈
│   │   ├── __init__.py
│   │   ├── normalizer.py           # 데이터 정규화
│   │   ├── deduplicator.py         # 중복 제거
│   │   └── scorer.py               # 점수 산정 알고리즘
│   │
│   ├── publishers/                 # 콘텐츠 발행 모듈
│   │   ├── __init__.py
│   │   ├── content_generator.py    # AI 게시글 생성
│   │   ├── threads_publisher.py    # Threads 자동 게시
│   │   └── image_generator.py      # 카드뉴스 생성 (옵션)
│   │
│   ├── api/                        # FastAPI 라우터
│   │   ├── __init__.py
│   │   ├── keywords.py             # 키워드 관련 API
│   │   ├── data.py                 # 데이터 조회 API
│   │   ├── reports.py              # 리포트 API
│   │   └── health.py               # 헬스체크
│   │
│   ├── services/                   # 비즈니스 로직
│   │   ├── __init__.py
│   │   ├── collection_service.py   # 수집 오케스트레이션
│   │   ├── analysis_service.py     # 분석 및 점수 산정
│   │   └── report_service.py       # 리포트 생성
│   │
│   ├── scheduler/                  # 작업 스케줄러
│   │   ├── __init__.py
│   │   ├── jobs.py                 # 스케줄 작업 정의
│   │   └── triggers.py             # 트리거 설정
│   │
│   └── utils/                      # 공통 유틸리티
│       ├── __init__.py
│       ├── json_ops.py             # JSON 처리 (사용자 규칙)
│       ├── date_utils.py           # 날짜 처리
│       └── text_utils.py           # 텍스트 처리
│
├── tests/                          # 테스트 코드
│   ├── __init__.py
│   ├── test_collectors/
│   ├── test_processors/
│   └── test_api/
│
├── scripts/                        # 스크립트 파일
│   ├── init_db.py                  # DB 초기화
│   ├── seed_data.py                # 테스트 데이터 생성
│   └── run_scheduler.py            # 스케줄러 실행
│
├── alembic/                        # DB 마이그레이션
│   ├── versions/
│   └── env.py
│
└── data/                           # 로컬 데이터 저장
    ├── cache/                      # 임시 캐시
    └── exports/                    # 내보내기 파일


주요 모듈 상세 설명
================================================================================

1. core/config.py
---
역할: 환경변수 로드 및 앱 설정 관리

주요 내용:
- APIFY_API_KEY
- YOUTUBE_API_KEY
- OPENAI_API_KEY
- DATABASE_URL
- REDIS_URL
- 스케줄 설정 (CRON 표현식)

구현 방식:
- pydantic-settings 사용
- .env 파일 자동 로드


2. collectors/base_collector.py
---
역할: 모든 수집기의 추상 베이스 클래스

주요 메서드:
- collect(): 데이터 수집 (추상 메서드)
- validate(): 수집 데이터 검증
- save_raw(): 원시 데이터 저장
- handle_error(): 에러 처리 및 재시도


3. collectors/google_trends.py
---
역할: Google Trends API를 통한 트렌드 키워드 수집

주요 기능:
- Apify Actor 호출
- 국가별 트렌딩 키워드 수집
- 급상승 키워드 플래그 처리

API 샘플:
from apify_client import ApifyClient

client = ApifyClient(os.getenv('APIFY_API_KEY'))
run = client.actor('data_xplorer/google-trends-fast-scraper').call(
    run_input={'geo': 'KR', 'timeframe': 'now 7-d'}
)


4. processors/scorer.py
---
역할: 점수 산정 알고리즘 구현

주요 메서드:
- calculate_popularity_score()
- calculate_momentum_score()
- calculate_recency_score()
- calculate_multi_source_score()
- calculate_total_score()

입력: normalized_data 리스트
출력: 점수 및 랭킹 정보


5. publishers/content_generator.py
---
역할: LLM을 활용한 Threads 게시글 자동 생성

주요 기능:
- 상위 이슈 요약
- 트렌드 분석 텍스트 생성
- 해시태그 자동 추가
- 다국어 지원

LLM 활용:
from langchain.chat_models import ChatOpenAI
from langchain.prompts import ChatPromptTemplate

llm = ChatOpenAI(model='gpt-4', temperature=0.7)


6. scheduler/jobs.py
---
역할: APScheduler를 사용한 자동화 작업 정의

주요 작업:
- collect_google_trends_job()  # 09:00, 15:00, 21:00
- collect_youtube_job()         # 10:00
- collect_instagram_job()       # 10:00, 16:00
- collect_news_job()            # 매시간
- analyze_and_rank_job()        # 12:00, 21:30
- publish_threads_job()         # 22:00

스케줄러 설정:
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger

scheduler = BackgroundScheduler()
scheduler.add_job(
    collect_google_trends_job,
    trigger=CronTrigger(hour='9,15,21'),
    id='google_trends'
)


7. api/keywords.py
---
역할: 키워드 관련 REST API 엔드포인트

엔드포인트:
- GET /keywords/trending?country=KR          # 트렌딩 키워드 조회
- GET /keywords/{keyword_id}                 # 키워드 상세
- POST /keywords/custom                      # 사용자 지정 키워드 추가
- GET /keywords/ranking?country=KR&top=20    # 랭킹 조회


8. services/collection_service.py
---
역할: 여러 수집기를 오케스트레이션

주요 메서드:
- run_all_collectors(country: str)
- run_collector_by_source(source: str)
- schedule_collection()

비동기 처리:
import asyncio

async def run_all_collectors(country):
    tasks = [
        collect_google_trends(country),
        collect_youtube(country),
        collect_instagram(country)
    ]
    results = await asyncio.gather(*tasks)
    return results


데이터 흐름도
================================================================================

1. 수집 단계
   Scheduler -> CollectionService -> Collectors -> RawData (DB)

2. 처리 단계
   RawData -> Normalizer -> NormalizedData (DB)
   NormalizedData -> Deduplicator -> UniqueData
   UniqueData -> Scorer -> ScoredData

3. 분석 단계
   ScoredData -> AnalysisService -> Ranking -> Report (DB)

4. 발행 단계
   Report -> ContentGenerator -> ThreadsPublisher -> 실제 게시


데이터베이스 연결 플로우
================================================================================

1. PostgreSQL (메인 저장소)
   - SQLAlchemy ORM 사용
   - Alembic 마이그레이션
   - 비동기 엔진 (asyncpg)

2. Redis (캐싱)
   - API 응답 캐싱
   - 임시 작업 상태 저장
   - 중복 체크 빠른 조회

3. Google Sheets (옵션)
   - 최종 리포트 내보내기
   - gspread 라이브러리 사용


핵심 의존성 패키지 (requirements.txt)
================================================================================

# 웹 프레임워크
fastapi==0.109.0
uvicorn[standard]==0.27.0
pydantic==2.5.0
pydantic-settings==2.1.0

# 데이터베이스
sqlalchemy[asyncio]==2.0.25
asyncpg==0.29.0
alembic==1.13.1
redis==5.0.1

# API 클라이언트
apify-client==1.6.0
google-api-python-client==2.115.0
feedparser==6.0.10
requests==2.31.0
httpx==0.26.0

# 스케줄러
apscheduler==3.10.4

# AI/LLM
langchain==0.1.5
langchain-openai==0.0.5
openai==1.10.0

# 데이터 처리
pandas==2.2.0
numpy==1.26.3
scikit-learn==1.4.0

# 유틸리티
python-dotenv==1.0.0
python-multipart==0.0.6
loguru==0.7.2

# 테스트
pytest==7.4.4
pytest-asyncio==0.23.3
httpx==0.26.0


환경변수 설정 (.env 예시)
================================================================================

# API Keys
APIFY_API_KEY=apify_api_xxxxxxxxxxxxx
YOUTUBE_API_KEY=AIzaSyxxxxxxxxxxxxx
OPENAI_API_KEY=sk-xxxxxxxxxxxxx

# Database
DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/trend_db
REDIS_URL=redis://localhost:6379/0

# App Settings
ENV=development
LOG_LEVEL=INFO
CORS_ORIGINS=http://localhost:3000

# Collection Schedule
GOOGLE_TRENDS_SCHEDULE=0 9,15,21 * * *
YOUTUBE_SCHEDULE=0 10 * * *


다음 단계
================================================================================

1. 가상환경 생성 및 패키지 설치
   명령어: python -m venv venv
   명령어: .\venv\Scripts\activate
   명령어: pip install -r requirements.txt

2. 데이터베이스 초기화
   명령어: alembic upgrade head

3. 환경변수 설정
   .env 파일 생성 및 API 키 입력

4. 개발 시작
   core 모듈부터 순차 개발
